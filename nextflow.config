params {
    // Profile info
    config_profile_description = 'Alliance HPC config'
    config_profile_contact = 'https://docs.alliancecan.ca/wiki/Technical_support'
    config_profile_url = 'docs.alliancecan.ca/wiki/Nextflow'

    // Base directory - automatically set to where the pipeline is run from
    // Users can override this with --base_dir /path/to/project
    base_dir = "$projectDir"

    // Input/output paths (relative to base_dir by default)
    // Users can override these with absolute paths if needed:
    // --data_dir /absolute/path/to/data
    // --output_dir /absolute/path/to/results
    data_dir = "${base_dir}/data"
    output_dir = "${base_dir}/results"
    bin_dir = "${base_dir}/bin"

    // Reference files (relative to data_dir)
    // These assume standard directory structure within data/ld_reference/
    ref_ld_chr = "${data_dir}/ld_reference/g1000_eur/g1000_eur"
    w_ld_chr = "${data_dir}/ld_reference/eur_w_ld_chr"
    hapmap_ref = "${data_dir}/ld_reference/w_hm3.snplist"
    locus_file = "${data_dir}/ld_reference/blocks_s2500_EUR_chr1-23full.GRCh37_hg19.locfile"

    // Containers
    ldsc_container = "${bin_dir}/ldsc_latest.sif"
}

apptainer {
  enabled = true
  autoMounts = true
  runOptions = "-B ${params.data_dir}/ld_reference/ \
                -B ${params.output_dir}/"
}

process {
  executor = 'slurm' 
  clusterOptions = '--account=def-xxxxx' // User needs to set the account
  maxRetries = 1
  errorStrategy = { task.exitStatus in [125,139] ? 'retry' : 'finish' }
  memory = 10.GB
  cpus = 5  
  time = 1.h

  withLabel: ldsc {
    container = "file://${params.ldsc_container}"
  }

  withLabel: lava {
    memory = 10.GB
    time = 23.h
    cpus = 5
  }

}

executor {
  pollInterval = '60 sec'
  submitRateLimit = '60/1min'
  queueSize = 100 
}

profiles {
  // Alliance Canada profiles
  beluga {
    process.clusterOptions = '--account=def-xxxxx'
    params.max_memory = '186.GB'
    params.max_cpus = 40
    params.max_time = '168.h'
  }
  
  narval {
    process.clusterOptions = '--account=def-xxxxx'
    params.max_memory = '249.GB'
    params.max_cpus = 64
    params.max_time = '168.h'
  }
  
  // Local execution profile (for testing or non-HPC systems)
  local {
    process.executor = 'local'
    process.cpus = 2
    process.memory = 4.GB
    docker.enabled = true
    docker.runOptions = '-u $(id -u):$(id -g)'
  }
  
  // Custom profile template
  custom {
    // Users can create their own profile
    process.executor = 'sge' // or 'pbs', 'lsf', etc.
    process.queue = 'normal'
    // Add custom settings
  }
}